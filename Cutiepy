import matplotlib.pyplot as plt
import numpy as np



#Input
Drainage_area= 640 #in acres
h= 78 #net thickness in feet
k=7 #permeability in millidarcies
Tres= 655 #in Rankine
phi=0.15 #porosity
Sg=0.8 #gas saturation
rw= 0.354 #well radius
re=np.sqrt(Drainage_area*43560/np.pi) #reservoir extent
L=10000 #tubing length in feet
tubing_ID=4.5
roughness= 0.0006
turb_coeff= 0.0001
skin=0
Tsurf=585
dev_angle=90*np.pi/180
OGIP= 43560*Drainage_area*h*phi*Sg/0.00358
gas_gravity=0.69
Tavg=620
psurf=150



pres=5000 #Reservoir pressure
pwf1= np.linspace(150,4950,97)
pwf=np.linspace(4950,150,97)

mu=[0.026875283,0.026705903,0.026536004,0.026365598,0.026194693,0.026023301,0.025851435,0.025679106,0.02550633,0.02533312,0.025159491,0.024985461,0.024811047,0.024636267,0.024461142,0.024285691,0.024109936,0.023933902,0.023757611,0.023581091,0.023404367,0.023227468,0.023050424,0.022873267,0.022696028,0.022518744,0.022341448,0.02216418,0.021986978,0.021809884,0.021632941,0.021456193,0.021279687,0.021103471,0.020927597,0.020752115,0.020577081,0.020402551,0.020228582,0.020055236,0.019882573,0.019710657,0.019539555,0.019369334,0.019200062,0.01903181,0.01886465,0.018698655,0.0185339,0.018370459,0.018208409,0.018047826,0.017888788,0.01773137,0.01757565,0.017421704,0.017269607,0.017119434,0.016971258,0.016825149,0.016681177,0.01653941,0.016399913,0.016262746,0.01612797,0.015995639,0.015865807,0.015738523,0.015613832,0.015491777,0.015372396,0.015255723,0.015141792,0.015030628,0.014922259,0.014816706,0.014713987,0.014614122,0.014517124,0.014423008,0.014331787,0.014243472,0.014158076,0.014075613,0.013996098,0.013919548,0.013845988,0.013775443,0.01370795,0.013643555,0.013582316,0.01352431,0.01346964,0.01341844,0.013370899,0.01332728,0.011917069]
Z=[0.976537227,0.973053218,0.969599318,0.966176478,0.962785677,0.959427931,0.956104287,0.952815825,0.949563666,0.946348962,0.943172907,0.940036732,0.936941711,0.933889158,0.930880429,0.927916925,0.925000093,0.922131424,0.919312459,0.916544784,0.913830037,0.911169905,0.908566125,0.906020486,0.903534829,0.901111045,0.898751079,0.896456927,0.894230635,0.892074301,0.88999007,0.887980137,0.88604674,0.884192162,0.882418724,0.880728785,0.879124736,0.877608994,0.876183999,0.874852207,0.873616081,0.872478086,0.871440679,0.870506301,0.869677364,0.868956244,0.868345267,0.867846697,0.867462725,0.867195455,0.867046888,0.867018913,0.867113288,0.867331633,0.867675408,0.868145909,0.868744248,0.869471348,0.870327928,0.871314497,0.872431344,0.873678536,0.875055909,0.876563068,0.878199388,0.879964012,0.881855859,0.883873622,0.886015785,0.888280623,0.890666217,0.893170465,0.895791094,0.898525674,0.901371634,0.904326277,0.907386792,0.910550277,0.913813745,0.917174149,0.920628389,0.924173332,0.927805821,0.931522691,0.935320781,0.939196943,0.943148052,0.947171018,0.951262791,0.95542037,0.959640809,0.963921222,0.968258788,0.972650752,0.977094434,0.981587227,0.979769414]

muavg=sum(mu)/len(mu)
Zavg=sum(Z)/len(Z)
p_bar=sum(pwf)/len(pwf)

#Gas pseudopressure function
mp=[]
deltamp=[]
for f in range(0,97):
    mp.append(2*p_bar*(pres-pwf1[f])/(muavg*Zavg))
    deltamp.append(-1*(mp[0]-mp[f]))


#quadratic equation solver to find flow rate q
   
a=1424*Tres*turb_coeff/(k*h)   
b=1424*Tres*(np.log(0.472*re/rw)+skin)/(k*h)   
D=[]
for j in range(0,97):
    D.append(np.sqrt(b**2-4*a*deltamp[j]))
#print(D)

q=[]
for f in range(0,len(D)):
    q.append((-b+D[f])/(2*a))
#print("flow rate=", q)

#VLP curve
s=-0.0375*gas_gravity*L*np.sin(dev_angle)/(Zavg*Tavg)
rho=[]
Nre=[]
ff=[]
p1=[]
for i in range(0,97):
    rho.append(28.97*gas_gravity*pwf[i]/(Z[i]*10.73*Tres))
    Nre.append(1.48*q[i]*rho[i]/(tubing_ID*mu[i]))
    ff.append((-4*np.log10((roughness/3.7065)-(5.0452/Nre[i])*np.log10((roughness**1.1098/2.8257)+(7.149/Nre[i])**0.8981)))**-2)
    p1.append((np.exp(-s)*psurf**2-0.002685*ff[i]*(Zavg*Tavg*q[i])**2*(1-np.exp(-s))/(tubing_ID**5*np.sin(dev_angle)))**0.5)
#print(p1)
plt.plot(q,pwf,'bo',q,p1,'ro')
plt.title("IPR&VLP")
plt.xlabel("flow rate q in MSCF/D")
plt.ylabel("flowing well pressure pwf in psi")
plt.show() 

