# https://circleci.com/gh/spyder-ide/spyder

machine:
  environment:
    # Python versions to tests (Maximum of 4 different versions)
    PY_VERSIONS: "2.7 3.4 3.5"
    # Environment variables used by astropy helpers
    TRAVIS_OS_NAME: "linux"
    CONDA_DEPENDENCIES_FLAGS: "--quiet"
    CONDA_DEPENDENCIES: >
      rope jedi pyflakes sphinx pygments pylint pep8 psutil nbconvert qtawesome pickleshare
      qtpy pyzmq chardet mock nomkl pandas pytest pytest-cov
    PIP_DEPENDENCIES: "coveralls pytest-qt"

dependencies:
  override:
    # First convert PY_VERSIONS to an array and then select the python version based on the CIRCLE_NODE_INDEX
    - export PY_VERSIONS=($PY_VERSIONS) &&
      export TRAVIS_PYTHON_VERSION=${PY_VERSIONS[$CIRCLE_NODE_INDEX]} && 
      echo -e "PYTHON = $TRAVIS_PYTHON_VERSION \n============" &&
      git clone git://github.com/astropy/ci-helpers.git > /dev/null &&
      source ci-helpers/travis/setup_conda_$TRAVIS_OS_NAME.sh &&
      export PATH="$HOME/miniconda/bin:$PATH" &&
      conda update -q conda &&
      source activate test &&
      conda install -q ciocheck -c conda-forge &&
      python setup.py install > /dev/null;

test:
  override:
    # Style checks
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && ciocheck spyder: # note the colon
        parallel: true
    # PyQt5
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && conda install -q qt=5.* pyqt=5.* qtconsole && python runtests.py: # note the colon
        parallel: true
    # Coveralls
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && coveralls: # note the colon
        parallel: true
    # PyQt4
#    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && conda install qt=4.* pyqt=4.* qtconsole && python runtests.py: # note the colon
#        parallel: true
